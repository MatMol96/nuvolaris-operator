import nuvolaris.testutil as tu
import nuvolaris.kustomize as kus
import nuvolaris.kube as kube
import requests as req

cm = kus.configMapTemplate("index", "test-cm", "index.html", {"item":"Hello"})
res = kus.kustom_list("test-cm", cm)
kube.apply(res)
kube.wait("pod/test-pod", "condition=Ready")
#!kubectl -n nuvolaris wait po/test-pod --for=condition=Ready
assert( req.get("http://localhost:3233").text.find("Hello") >0 )
kube.delete(res)